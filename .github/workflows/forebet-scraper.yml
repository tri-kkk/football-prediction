# Forebet Blog Auto-Publisher
# ë§¤ì¼ KST 9ì‹œ (UTC 0ì‹œ) ìë™ ì‹¤í–‰
name: Forebet Blog Publisher

on:
  schedule:
    # ë§¤ì¼ UTC 0ì‹œ = KST 9ì‹œ
    - cron: '0 0 * * *'
  
  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
  workflow_dispatch:

jobs:
  scrape-and-publish:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 1
      
      - name: ğŸŸ¢ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: ğŸ“¦ Install dependencies (clean)
        working-directory: ./scripts/forebet-scraper
        run: |
          rm -rf node_modules package-lock.json
          npm install
          echo "ğŸ“‹ Installed packages:"
          npm list --depth=0
      
      - name: ğŸ” Run Scraper
        working-directory: ./scripts/forebet-scraper
        env:
          THESPORTSDB_API_KEY: ${{ secrets.THESPORTSDB_API_KEY }}
        run: node scraper.js
        continue-on-error: false
      
      - name: ğŸ¤– Run AI Processor
        working-directory: ./scripts/forebet-scraper
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: node ai-processor.js
        continue-on-error: false
      
      - name: ğŸ“¤ Upload to Supabase
        working-directory: ./scripts/forebet-scraper
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
        run: node supabase-uploader.js
      
      - name: ğŸ§¹ Cleanup
        working-directory: ./scripts/forebet-scraper
        run: |
          rm -f scraped-previews.json
          rm -f processed-previews.json
      
      - name: âœ… Done
        run: echo "Blog posts published successfully!"
